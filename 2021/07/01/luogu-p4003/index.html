<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"example.com",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.json"}</script><meta name="description" content="就我的建图这么清奇？ 由于这是一个网格图而且还有各种奇怪的形状和限制以及奇怪的数据范围，可以往网络流考虑。"><meta property="og:type" content="article"><meta property="og:title" content="题解 【P4003 无限之环】"><meta property="og:url" content="http://example.com/2021/07/01/luogu-p4003/index.html"><meta property="og:site_name" content="zqs&#96;s blog"><meta property="og:description" content="就我的建图这么清奇？ 由于这是一个网格图而且还有各种奇怪的形状和限制以及奇怪的数据范围，可以往网络流考虑。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2021/06/29/JSYfADvwcZpMBL8.jpg"><meta property="article:published_time" content="2021-07-01T12:41:40.000Z"><meta property="article:modified_time" content="2021-07-01T12:42:53.328Z"><meta property="article:author" content="zqs菜鸡"><meta property="article:tag" content="网络流"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2021/06/29/JSYfADvwcZpMBL8.jpg"><link rel="canonical" href="http://example.com/2021/07/01/luogu-p4003/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>题解 【P4003 无限之环】 | zqs`s blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/ioiakzqs" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">zqs`s blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">有朋自远方来，虽远必诛</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2021/07/01/luogu-p4003/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="zqs菜鸡"><meta itemprop="description" content="反正是个菜鸡"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="zqs`s blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 题解 【P4003 无限之环】</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-07-01 20:41:40 / 修改时间：20:42:53" itemprop="dateCreated datePublished" datetime="2021-07-01T20:41:40+08:00">2021-07-01</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%9B%BE%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">图论</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/2021/07/01/luogu-p4003/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/07/01/luogu-p4003/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><del>就我的建图这么清奇？</del></p><p>由于这是一个网格图而且还有各种奇怪的形状和限制以及奇怪的数据范围，可以往网络流考虑。</p><span id="more"></span><p>如果一个图不漏水，那么每个格子的度数必定是这个格子的水管的分叉数。</p><p>对网格图进行黑白染色，则问题变为从黑点向白点提供一些度数，使得源点向黑点连的边和白点向汇点连的边均满流。</p><p>题目要求旋转次数最少，考虑费用流。</p><p>首先每个点拆成五个点，分别表示它往上下左右方向的连边和它本身。</p><p>以下只讨论黑格子。</p><p>从 $s$ 向这个格子本身的点连边，容量为这个格子水管分叉数（设为 $x$），费用为 $0$。表示不管怎么旋转它都会连接 $x$ 个方向。</p><p>格子按照分叉数和是否为直线分为以下 $5$ 种情况：</p><h2 id="1分叉（圆圈形）"><a href="#1分叉（圆圈形）" class="headerlink" title="1分叉（圆圈形）"></a>1分叉（圆圈形）</h2><p>没什么好说的，向上下左右各连一条容量 $1$， 费用为原方向旋转到这个方向的旋转次数即可。</p><h2 id="2分叉（直线形）"><a href="#2分叉（直线形）" class="headerlink" title="2分叉（直线形）"></a>2分叉（直线形）</h2><p>这种情况也很简单，直线不能转，根据直线是横着的还是竖着的向上下各连容量 $1$ 费用 $0$ 的边或向左右连边。</p><h2 id="2分叉（转弯形）"><a href="#2分叉（转弯形）" class="headerlink" title="2分叉（转弯形）"></a>2分叉（转弯形）</h2><p>这种情况必须横方向有一个水管，竖方向有一个水管，所以再额外建立两个点表示横方向和竖方向，然后向横点和竖点各连一条容量 $1$ 费用 $0$ 的边。</p><p>再从横点向上下连边，竖点向左右连边，容量均为 $1$，费用为开始水管的方向是否朝向了这里，如果是则为 $0$，否则为 $1$。</p><h2 id="3分叉（T字形）"><a href="#3分叉（T字形）" class="headerlink" title="3分叉（T字形）"></a>3分叉（T字形）</h2><p>这个情况看起来很难搞……</p><p><del>没事大不了我针对4种T形各拆一个点就好了</del></p><p>但这样做显然是不行的，因为流量会到处跑，<del>而且码量比较劝退。</del></p><p>那我们就直接按照 $1$ 分叉的连边改一改费用！</p><p>假设是这种朝下的T形：</p><p><img src="https://i.loli.net/2021/06/29/JSYfADvwcZpMBL8.jpg" alt=""></p><p>设向上面连的边费用为 $a_1$，向左连的边费用为 $a_2$，向右连的边费用为 $a_3$，向下为 $a_4$。</p><p>那么根据实际的旋转次数，我们希望这些费用满足以下条件：</p><script type="math/tex;mode=display">
\begin{cases}
a_1+a_2+a_3=2\\
a_1+a_2+a_4=1\\
a_1+a_3+a_4=1\\
a_2+a_3+a_4=0
\end{cases}</script><p>解一下方程发现 $a_1=4/3,a_2=a_3=1/3,a_4=-2/3$。</p><p>这里有一个技巧可以避免小数费用流带来的常数，因为整个图中只有这一个地方有分数的费用并且分母都是 $3$，所以只要把所有边的费用乘 $3$，输出的时候除回来就好了。</p><h2 id="4分叉（十字形）"><a href="#4分叉（十字形）" class="headerlink" title="4分叉（十字形）"></a>4分叉（十字形）</h2><p>如果看懂了上面的连边这里就不用我说了吧（</p><p>向上下左右各连一条容量 $1$ 费用 $0$ 的边即可。</p><p>白点就是把上面的连边全部反过来了，为了避免复制粘贴使得代码看起来很长我用了rev变量标记。</p><p>然后有个相邻点之间的连边，比如 $(x,y)$ 的黑点的上方连 $(x-1,y)$ 的白点的下方等等，很简单就不赘述了。</p><div><div class="fold_hider"><div class="close hider_title">代码</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> U 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> D 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> R 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UD 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LR 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">min</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x, <span class="keyword">const</span> <span class="keyword">int</span> y)</span> </span>&#123;<span class="keyword">return</span> x &lt; y ? x : y;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, cost, nxt;</span><br><span class="line">&#125; e[<span class="number">10000005</span>];</span><br><span class="line"><span class="keyword">int</span> head[<span class="number">100005</span>], cur[<span class="number">100005</span>], dis[<span class="number">100005</span>];</span><br><span class="line"><span class="keyword">int</span> tot = <span class="number">1</span>, s, t, Maxflow, Mincost;</span><br><span class="line"><span class="keyword">bool</span> vis[<span class="number">100005</span>], mark[<span class="number">100005</span>];</span><br><span class="line">std::queue&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line"><span class="keyword">bool</span> rev;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> cap, <span class="keyword">int</span> cost, <span class="keyword">bool</span> mul = <span class="literal">true</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (rev) u ^= v ^= u ^= v;</span><br><span class="line">	<span class="keyword">if</span> (mul) cost *= <span class="number">3</span>;</span><br><span class="line">	e[++ tot].to = v, e[tot].nxt = head[u], head[u] = tot;</span><br><span class="line">	e[tot].cap = cap, e[tot].cost = cost;</span><br><span class="line">	e[++ tot].to = u, e[tot].nxt = head[v], head[v] = tot;</span><br><span class="line">	e[tot].cap = <span class="number">0</span>, e[tot].cost = -cost;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memcpy</span>(cur, head, <span class="keyword">sizeof</span> cur);</span><br><span class="line">	<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span> vis);</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line">	<span class="built_in">memset</span>(mark, <span class="number">0</span>, <span class="keyword">sizeof</span> mark);</span><br><span class="line">	Q.<span class="built_in">push</span>(s);</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (Q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="function"><span class="keyword">int</span> <span class="title">u</span><span class="params">(Q.front())</span></span>;</span><br><span class="line">		Q.<span class="built_in">pop</span>();</span><br><span class="line">		mark[u] = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = e[i].nxt) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = e[i].to;</span><br><span class="line">			<span class="keyword">if</span> (e[i].cap &amp;&amp; dis[u] + e[i].cost &lt; dis[v]) &#123;</span><br><span class="line">				dis[v] = dis[u] + e[i].cost;</span><br><span class="line">				<span class="keyword">if</span> (!mark[v]) Q.<span class="built_in">push</span>(v), mark[v] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[t] &lt; INF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">	vis[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">int</span> used = <span class="number">0</span>, tmp;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = cur[u]; i &amp;&amp; used &lt;= flow; i = e[i].nxt) &#123;</span><br><span class="line">		cur[u] = i;</span><br><span class="line">		<span class="keyword">if</span> (e[i].cap &amp;&amp; dis[u] + e[i].cost == dis[e[i].to]) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = e[i].to;</span><br><span class="line">			<span class="keyword">if</span> (!vis[v] &amp;&amp; (tmp = <span class="built_in">dfs</span>(v, <span class="built_in">min</span>(flow - used, e[i].cap))))</span><br><span class="line">				used += tmp, e[i].cap -= tmp, e[i ^ <span class="number">1</span>].cap += tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> used;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">SPFA</span>()) Maxflow += (flow = <span class="built_in">dfs</span>(s, INF)), Mincost += flow * dis[t];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, id[<span class="number">2005</span>][<span class="number">6</span>], a[<span class="number">2005</span>], cnt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pos</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;<span class="keyword">return</span> (i - <span class="number">1</span>) * m + j;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum1 = <span class="number">0</span>, sum2 = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">	s = <span class="number">0</span>, t = <span class="number">20000</span>, cnt = n * m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++ j) &#123;</span><br><span class="line">		<span class="keyword">int</span> p = <span class="built_in">pos</span>(i, j);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, a + p);</span><br><span class="line">		<span class="keyword">if</span> (!a[p]) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; ++ k)</span><br><span class="line">			<span class="keyword">if</span> (a[p] &amp; <span class="number">1</span> &lt;&lt; k) ++ len;</span><br><span class="line">		rev = i + j &amp; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (!rev) <span class="built_in">AddEdge</span>(s, p, len, <span class="number">0</span>), sum1 += len;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">AddEdge</span>(t, p, len, <span class="number">0</span>), sum2 += len;</span><br><span class="line">		<span class="built_in"><span class="keyword">switch</span></span> (a[p]) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][U] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][D] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][L] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][R] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][U] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">1</span> ? <span class="number">0</span> : (a[p] == <span class="number">4</span> ? <span class="number">2</span> : <span class="number">1</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][D] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">4</span> ? <span class="number">0</span> : (a[p] == <span class="number">1</span> ? <span class="number">2</span> : <span class="number">1</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][L] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">8</span> ? <span class="number">0</span> : (a[p] == <span class="number">2</span> ? <span class="number">2</span> : <span class="number">1</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][R] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">2</span> ? <span class="number">0</span> : (a[p] == <span class="number">8</span> ? <span class="number">2</span> : <span class="number">1</span>)));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][UD] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][LR] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(id[p][UD], id[p][U] = ++ cnt, <span class="number">1</span>, !((<span class="keyword">bool</span>)(a[p] &amp; <span class="number">1</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(id[p][UD], id[p][D] = ++ cnt, <span class="number">1</span>, !((<span class="keyword">bool</span>)(a[p] &amp; <span class="number">4</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(id[p][LR], id[p][L] = ++ cnt, <span class="number">1</span>, !((<span class="keyword">bool</span>)(a[p] &amp; <span class="number">8</span>)));</span><br><span class="line">				<span class="built_in">AddEdge</span>(id[p][LR], id[p][R] = ++ cnt, <span class="number">1</span>, !((<span class="keyword">bool</span>)(a[p] &amp; <span class="number">2</span>)));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">			<span class="keyword">case</span> <span class="number">14</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][U] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">11</span> ? <span class="number">-2</span> : (a[p] == <span class="number">14</span> ? <span class="number">4</span> : <span class="number">1</span>)), <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][D] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">14</span> ? <span class="number">-2</span> : (a[p] == <span class="number">11</span> ? <span class="number">4</span> : <span class="number">1</span>)), <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][L] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">13</span> ? <span class="number">-2</span> : (a[p] == <span class="number">7</span> ? <span class="number">4</span> : <span class="number">1</span>)), <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][R] = ++ cnt, <span class="number">1</span>, (a[p] == <span class="number">7</span> ? <span class="number">-2</span> : (a[p] == <span class="number">13</span> ? <span class="number">4</span> : <span class="number">1</span>)), <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][U] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][D] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][L] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">AddEdge</span>(p, id[p][R] = ++ cnt, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	rev = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++ j)</span><br><span class="line">		<span class="keyword">if</span> (!(i + j &amp; <span class="number">1</span>) &amp;&amp; a[<span class="built_in">pos</span>(i, j)]) &#123;</span><br><span class="line">			<span class="keyword">int</span> p = <span class="built_in">pos</span>(i, j);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; ++ k) &#123;</span><br><span class="line">				<span class="keyword">int</span> x = i + dx[k], y = j + dy[k];</span><br><span class="line">				<span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || n &lt; x || m &lt; y || !a[<span class="built_in">pos</span>(x, y)]) <span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">int</span> p2 = <span class="built_in">pos</span>(x, y);</span><br><span class="line">				<span class="keyword">if</span> (id[p][U] &amp;&amp; id[p2][D] &amp;&amp; k == <span class="number">0</span>) <span class="built_in">AddEdge</span>(id[p][U], id[p2][D], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span> (id[p][D] &amp;&amp; id[p2][U] &amp;&amp; k == <span class="number">1</span>) <span class="built_in">AddEdge</span>(id[p][D], id[p2][U], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span> (id[p][L] &amp;&amp; id[p2][R] &amp;&amp; k == <span class="number">2</span>) <span class="built_in">AddEdge</span>(id[p][L], id[p2][R], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span> (id[p][R] &amp;&amp; id[p2][L] &amp;&amp; k == <span class="number">3</span>) <span class="built_in">AddEdge</span>(id[p][R], id[p2][L], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="built_in">Dinic</span>();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, Maxflow == sum1 &amp;&amp; sum1 == sum2 ? Mincost / <span class="number">3</span> : <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zqs菜鸡</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://example.com/2021/07/01/luogu-p4003/" title="题解 【P4003 无限之环】">http://example.com/2021/07/01/luogu-p4003/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" rel="tag"><i class="fa fa-tag"></i> 网络流</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2021/06/27/nkoj-4134/" rel="prev" title="nkoj4134题解"><i class="fa fa-chevron-left"></i> nkoj4134题解</a></div><div class="post-nav-item"> <a href="/2021/07/03/luogu-P5071/" rel="next" title="题解 【P5071 [Ynoi2015] 此时此刻的光辉】">题解 【P5071 [Ynoi2015] 此时此刻的光辉】<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E5%88%86%E5%8F%89%EF%BC%88%E5%9C%86%E5%9C%88%E5%BD%A2%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">1分叉（圆圈形）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E5%88%86%E5%8F%89%EF%BC%88%E7%9B%B4%E7%BA%BF%E5%BD%A2%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">2分叉（直线形）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E5%88%86%E5%8F%89%EF%BC%88%E8%BD%AC%E5%BC%AF%E5%BD%A2%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">2分叉（转弯形）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E5%88%86%E5%8F%89%EF%BC%88T%E5%AD%97%E5%BD%A2%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">3分叉（T字形）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E5%88%86%E5%8F%89%EF%BC%88%E5%8D%81%E5%AD%97%E5%BD%A2%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">4分叉（十字形）</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">zqs菜鸡</p><div class="site-description" itemprop="description">反正是个菜鸡</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">68</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ioiakzqs" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ioiakzqs" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://gitee.com/zqs2020" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;zqs2020" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gitee</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/jvruo_shabi" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;jvruo_shabi" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="https://www.luogu.com.cn/user/361308" title="洛谷 → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;361308" rel="noopener" target="_blank"><i class="fa fa-fw fa-code"></i> 洛谷</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div style=""><canvas id="canvas" style="width:60%">当前浏览器不支持canvas，请更换浏览器后再试</canvas></div><script>!function(){var t,o=[[[0,0,1,1,1,0,0],[0,1,1,0,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1,0],[0,0,1,1,1,0,0]],[[0,0,0,1,1,0,0],[0,1,1,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[1,1,1,1,1,1,1]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,0,0,1,1],[1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,1,1,0,1,1,0],[1,1,0,0,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,1]],[[1,1,1,1,1,1,1],[1,1,0,0,0,0,0],[1,1,0,0,0,0,0],[1,1,1,1,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[1,1,1,1,1,1,1],[1,1,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,1,1,0,0,0,0]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]]],e=document.getElementById("canvas");if(e.getContext){var l=e.getContext("2d");e.height=100,e.width=700,l.fillStyle="#f00",l.fillRect(10,10,50,50);var r=[],f=[],i=e.height/20-1;function n(t,e){for(var n=0;n<o[e].length;n++)for(var a=0;a<o[e][n].length;a++)1==o[e][n][a]&&(l.beginPath(),l.arc(14*(i+2)*t+2*a*(i+1)+(i+1),2*n*(i+1)+(i+1),i,0,2*Math.PI),l.closePath(),l.fill())}function h(t,e){for(var n=[1,2,3],a=["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"],l=0;l<o[e].length;l++)for(var r=0;r<o[e][l].length;r++)if(1==o[e][l][r]){var h={x:14*(i+2)*t+2*r*(i+1)+(i+1),y:2*l*(i+1)+(i+1),stepX:Math.floor(4*Math.random()-2),stepY:-2*n[Math.floor(Math.random()*n.length)],color:a[Math.floor(Math.random()*a.length)],disY:1};f.push(h)}}t=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date),r.push(t[1],t[2],10,t[3],t[4],10,t[5],t[6]),clearInterval(a);var a=setInterval(function(){!function(){var t=[],e=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date),n=[];n.push(e[1],e[2],10,e[3],e[4],10,e[5],e[6]);for(var a=r.length-1;0<=a;a--)n[a]!==r[a]&&t.push(a+"_"+(Number(r[a])+1)%10);for(a=0;a<t.length;a++)h.apply(this,t[a].split("_"));r=n.concat()}(),function(){for(var t=0;t<f.length;t++)f[t].stepY+=f[t].disY,f[t].x+=f[t].stepX,f[t].y+=f[t].stepY,(f[t].x>700+i||f[t].y>100+i)&&(f.splice(t,1),t--)}(),function(){e.height=100;for(var t=0;t<r.length;t++)n(t,r[t]);for(t=0;t<f.length;t++)l.beginPath(),l.arc(f[t].x,f[t].y,i,0,2*Math.PI),l.fillStyle=f[t].color,l.closePath(),l.fill()}()},50)}}()</script></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zqs菜鸡</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three-waves.min.js"></script><script src="/js/local-search.js"></script><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://example.com/2021/07/01/luogu-p4003/',]
      });
      });
  </script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Ttn6wpyi3PGFvGaXy67O0CB7-gzGzoHsz',
      appKey     : 'hVx8JDoum8iYxMFoDaum95Ih',
      placeholder: "stO Orz",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/fold_action.js"></script><script type="text/javascript" src="/js/love.js"></script></body></html>